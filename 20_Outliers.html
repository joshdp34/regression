<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>STA 3386 Regression Analysis - 20&nbsp; Outliers and Influential Observations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./21_Residual.html" rel="next">
<link href="./19_Ridge.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./20_Outliers.html"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Outliers and Influential Observations</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./"></a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_Intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to Regression Analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_Fitting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Fitting the Simple Linear Regression Model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_Properties.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Properties of the Least Squares Estimators and Model Assumptions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_Sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Sampling Distribution of the Least Squares Estimators and Testing the Slope</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_Correlation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Correlation Coefficient and the Coefficient of Determination</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_Using.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Using the Simple Linear Model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_Checking.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Checking the Linearity and Constant Variance Assumptions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_Checking2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Checking the Normality and Independence Assumptions and Outliers</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_Tidymodels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Simple Linear Regression with Tidymodels</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_Intro_Multiple.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">An Intro to Multiple Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_Regression_Matrix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">The Regression Model in Matrix Terms</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_ANOVA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Model Assumptions and the ANOVA F-test</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_Inferences.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Model Inferences and Second-Order Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_Multicollinearity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Multicollinearity and Principal Component Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15_Indicator.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Indicator Variables</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16_Linearity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">The Linearity Assumption</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17_Criteria.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Model Comparison Criteria</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18_Stepwise.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Stepwise and Best Subsets Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19_Ridge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Ridge Regression and the LASSO</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20_Outliers.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Outliers and Influential Observations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21_Residual.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Residual Analysis and Remedial Measures</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22_Validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Model Validation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23_Logistic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Introduction to Logistic Regression</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#outliers-with-respect-to-the-response-variable" id="toc-outliers-with-respect-to-the-response-variable" class="nav-link active" data-scroll-target="#outliers-with-respect-to-the-response-variable"><span class="header-section-number">20.1</span> Outliers with Respect to the Response Variable</a></li>
  <li><a href="#studentized-residuals" id="toc-studentized-residuals" class="nav-link" data-scroll-target="#studentized-residuals"><span class="header-section-number">20.2</span> Studentized Residuals</a></li>
  <li><a href="#deleted-residuals" id="toc-deleted-residuals" class="nav-link" data-scroll-target="#deleted-residuals"><span class="header-section-number">20.3</span> Deleted Residuals</a></li>
  <li><a href="#studentized-deleted-residuals" id="toc-studentized-deleted-residuals" class="nav-link" data-scroll-target="#studentized-deleted-residuals"><span class="header-section-number">20.4</span> Studentized Deleted Residuals</a></li>
  <li><a href="#outliers-with-respect-to-the-predictor-variables" id="toc-outliers-with-respect-to-the-predictor-variables" class="nav-link" data-scroll-target="#outliers-with-respect-to-the-predictor-variables"><span class="header-section-number">20.5</span> Outliers with Respect to the Predictor Variables</a>
  <ul class="collapse">
  <li><a href="#leverage-values" id="toc-leverage-values" class="nav-link" data-scroll-target="#leverage-values"><span class="header-section-number">20.5.1</span> Leverage Values</a></li>
  <li><a href="#using-leverage-to-identify-hidden-extrapolation" id="toc-using-leverage-to-identify-hidden-extrapolation" class="nav-link" data-scroll-target="#using-leverage-to-identify-hidden-extrapolation"><span class="header-section-number">20.5.2</span> Using Leverage to Identify Hidden Extrapolation</a></li>
  </ul></li>
  <li><a href="#influential-cases" id="toc-influential-cases" class="nav-link" data-scroll-target="#influential-cases"><span class="header-section-number">20.6</span> Influential Cases</a>
  <ul class="collapse">
  <li><a href="#influence-on-a-single-fitted-value" id="toc-influence-on-a-single-fitted-value" class="nav-link" data-scroll-target="#influence-on-a-single-fitted-value"><span class="header-section-number">20.6.1</span> Influence on a Single Fitted Value</a></li>
  <li><a href="#influence-on-all-fitted-values" id="toc-influence-on-all-fitted-values" class="nav-link" data-scroll-target="#influence-on-all-fitted-values"><span class="header-section-number">20.6.2</span> Influence on All Fitted Values</a></li>
  <li><a href="#influence-on-the-coefficients" id="toc-influence-on-the-coefficients" class="nav-link" data-scroll-target="#influence-on-the-coefficients"><span class="header-section-number">20.6.3</span> Influence on the Coefficients</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Outliers and Influential Observations</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<blockquote class="blockquote">
<p>“Be approximately right rather than exactly wrong.” - John Tukey</p>
</blockquote>
<section id="outliers-with-respect-to-the-response-variable" class="level2" data-number="20.1">
<h2 data-number="20.1" class="anchored" data-anchor-id="outliers-with-respect-to-the-response-variable"><span class="header-section-number">20.1</span> Outliers with Respect to the Response Variable</h2>
<p>In <a href="08_Checking2.html"><span>Chapter&nbsp;8</span></a> we discussed <em>outliers</em> in the simple regression case.</p>
<p>Recall that a point can be outlying with respect to <span class="math inline">\(y\)</span> or with respect to <span class="math inline">\(x\)</span> but have little effect on the <em>fitted line</em>.</p>
<p>If an observation is outlying with respect to <span class="math inline">\(y\)</span> but has an <span class="math inline">\(x\)</span> value close to <span class="math inline">\(\bar{x}\)</span>, then it will have little effect on <span class="math inline">\(\hat{y}\)</span>. If it is far from <span class="math inline">\(\bar{x}\)</span>, it will have a large effect.</p>
<p>If an observation is an outlier with respect to <span class="math inline">\(x\)</span> but still follows the linear relationship between <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>, then it will also have little effect on <span class="math inline">\(\hat{y}\)</span>.</p>
<p>In multiple regression, we will still need to view the outliers with respect to <span class="math inline">\(y\)</span> and with respect to the predictor variables <span class="math inline">\(x_1\ldots,x_{p-1}\)</span>. We will identify these outlying observations by how they affect the fitted model <span class="math inline">\(\hat{y}\)</span>.</p>
</section>
<section id="studentized-residuals" class="level2" data-number="20.2">
<h2 data-number="20.2" class="anchored" data-anchor-id="studentized-residuals"><span class="header-section-number">20.2</span> Studentized Residuals</h2>
<p>Recall from <a href="07_Checking.html"><span>Chapter&nbsp;7</span></a> that semistudentized residuals <span class="math display">\[
\begin{align*}
e_{i}^{*} &amp; =\frac{e_{i}}{\sqrt{MSE}}
\end{align*}
\]</span> can be used to determine if an observation is an outlier.</p>
<p>We called them semistudentized because <span class="math inline">\(\sqrt{MSE}\)</span> is not an estimate of the true standard error of <span class="math inline">\(e_i\)</span>. Therefore dividing by <span class="math inline">\(\sqrt{MSE}\)</span> does not give a true student t-score.</p>
<p>With the hat matrix <span class="math display">\[
\begin{align*}
{\bf H} &amp; ={\bf X}\left({\bf X}^{\prime}{\bf X}\right)^{-1}{\bf X}^{\prime}
\end{align*}
\]</span> we can now present the true variance of <span class="math inline">\(e_i\)</span>: <span id="eq-w5_3"><span class="math display">\[
\begin{align}
Var\left[e_{i}\right] &amp; ={\sigma^{2}\left(1-h_{ii}\right)}
\end{align}
\tag{20.1}\]</span></span> where <span class="math inline">\(h_{ii}\)</span> is the <span class="math inline">\(i\)</span>th diagonal element of <span class="math inline">\(\bf{H}\)</span>.</p>
<p>We can estimate <span class="math inline">\(Var\left[e_{i}\right]\)</span> with <span id="eq-w5_4"><span class="math display">\[
\begin{align}
s^2\left[e_{i}\right] &amp; =MSE\left(1-h_{ii}\right)
\end{align}
\tag{20.2}\]</span></span></p>
<p>Dividing <span class="math inline">\(e_i\)</span> by <span class="math inline">\(s\left[e_{i}\right]\)</span> gives us a true t-score. Thus the *{studentized} residual is <span id="eq-w5_5"><span class="math display">\[
\begin{align}
r_{i} &amp; =\frac{e_{i}}{\sqrt{MSE\left(1-h_{ii}\right)}}
\end{align}
\tag{20.3}\]</span></span></p>
<p>A rule of thumb is any <span class="math inline">\(r_i\)</span> greater than 3 in absolute value should be considered an outlier with respect to <span class="math inline">\(y\)</span>.</p>
</section>
<section id="deleted-residuals" class="level2" data-number="20.3">
<h2 data-number="20.3" class="anchored" data-anchor-id="deleted-residuals"><span class="header-section-number">20.3</span> Deleted Residuals</h2>
<p>As we stated above, it is possible for an observation to be outlying with respect to <span class="math inline">\(y\)</span> but not have an effect on the fitted value.</p>
<p>Also, if <span class="math inline">\(y\)</span> does effect the fit greatly, then the fitted value <span class="math inline">\(\hat{y}\)</span> will be “pulled” towards <span class="math inline">\(y\)</span> and thus make <span class="math inline">\(r_i\)</span> not so large.</p>
<p>One way to see how an (potentially outlying) observation <span class="math inline">\(y_i\)</span> influences the fit is by first fitting the model without <span class="math inline">\(y_i\)</span> and then try to predict <span class="math inline">\(y_i\)</span> based on that fitted model.</p>
<p>The difference from the observed <span class="math inline">\(y_i\)</span> and the predicted value based on the model fitted with the remaining <span class="math inline">\(n-1\)</span> observations <span class="math inline">\(\hat{y}_{i(i)}\)</span> is called the <em>deleted</em> <em>residual</em>: <span id="eq-w5_6"><span class="math display">\[
\begin{align}
d_{i} &amp; =y_{i}-\hat{y}_{i\left(i\right)}
\end{align}
\tag{20.4}\]</span></span></p>
<p>At first glance, it would appear that obtaining <span class="math inline">\(d_i\)</span> for all observations would be computationally expensive since it would require a different fitted model for each <span class="math inline">\(i=1,\ldots,n\)</span>. However, it can be shown that the deleted residuals can be expressed as <span id="eq-w5_7"><span class="math display">\[
\begin{align}
d_{i} &amp; =\frac{e_{i}}{1-h_{ii}}
\end{align}
\tag{20.5}\]</span></span> which would not require a new fit for each <span class="math inline">\(i\)</span>.</p>
</section>
<section id="studentized-deleted-residuals" class="level2" data-number="20.4">
<h2 data-number="20.4" class="anchored" data-anchor-id="studentized-deleted-residuals"><span class="header-section-number">20.4</span> Studentized Deleted Residuals</h2>
<p>The estimated variance of the deleted residual <span class="math inline">\(d_{i}\)</span> is <span id="eq-w5_8"><span class="math display">\[
\begin{align}
s^{2}\left[d_{i}\right] &amp; =\frac{MSE_{(i)}}{1-h_{ii}}
\end{align}
\tag{20.6}\]</span></span> where <span class="math inline">\(MSE_{(i)}\)</span> is the <span class="math inline">\(MSE\)</span> of the fit with <span class="math inline">\(y_{i}\)</span> removed.</p>
<p>We can obtain a studentized deleted residual with <span id="eq-w5_9"><span class="math display">\[
\begin{align}
t_{i} &amp; =\frac{d_{i}}{s\left[d_{i}\right]}\nonumber\\
&amp; =\frac{e_{i}}{\sqrt{MSE_{(i)}\left(1-h_{ii}\right)}}
\end{align}
\tag{20.7}\]</span></span></p>
<p>Again, we do not need to calculate a new regression fit for each <span class="math inline">\(i\)</span> due to the relationship <span id="eq-w5_10"><span class="math display">\[
\begin{align}
MSE_{(i)} &amp; =\left(\frac{n-p}{n-p-1}\right)MSE-\frac{e_{i}^{2}}{\left(n-p-1\right)\left(1-h_{ii}\right)}
\end{align}
\tag{20.8}\]</span></span></p>
<p>Since <span class="math inline">\(t_{i}\)</span> follows a Student’s <span class="math inline">\(t\)</span> distribution with <span class="math inline">\(n-p-1\)</span> degrees of freedom, then any <span class="math inline">\(t_{i}\)</span> greater than <span class="math inline">\(t_{\alpha/2n}\)</span> will be considered a potential outlier.</p>
<p>Note that the <span class="math inline">\(\alpha/2n\)</span> is called a <em>Bonferroni</em> adjustment in that it divides the significance level <span class="math inline">\(\alpha\)</span> by <span class="math inline">\(2n\)</span>. This is done to control for an overall significance level of <span class="math inline">\(\alpha\)</span> when examining the <span class="math inline">\(n\)</span> studentized deleted residuals.</p>
</section>
<section id="outliers-with-respect-to-the-predictor-variables" class="level2" data-number="20.5">
<h2 data-number="20.5" class="anchored" data-anchor-id="outliers-with-respect-to-the-predictor-variables"><span class="header-section-number">20.5</span> Outliers with Respect to the Predictor Variables</h2>
<p>We can identify outliers with respect to the predictor variables with the help of the hat matrix <span class="math inline">\({\bf H}\)</span>.</p>
<p>We have already seen that it plays an important role in the studentized deleted residuals.</p>
<p>We will now use the diagonal elements of <span class="math inline">\({\bf H}\)</span>, <span class="math inline">\(h_{ii}\)</span>, as a measure of how far the <span class="math inline">\(x\)</span> values of an observation are from the center <span class="math inline">\(x\)</span> value of all the observations.</p>
<section id="leverage-values" class="level3" data-number="20.5.1">
<h3 data-number="20.5.1" class="anchored" data-anchor-id="leverage-values"><span class="header-section-number">20.5.1</span> Leverage Values</h3>
<p>We first note some properties or <span class="math inline">\(h_{ii}\)</span>: <span id="eq-w5_11"><span class="math display">\[
\begin{align}
&amp; 0\le h_{ii}\le1 &amp;\\
&amp; \sum h_{ii}=p &amp;
\end{align}
\tag{20.9}\]</span></span></p>
<p>The larger the value of <span class="math inline">\(h_{ii}\)</span>, the further the <span class="math inline">\(i\)</span>th observation is from the center of all the <span class="math inline">\(x\)</span>’s. Thus, we call <span class="math inline">\(h_{ii}\)</span> the <em>leverage</em>. If an observation has a large leverage value, then it has a substantial “leverage’’ in determining <span class="math inline">\(\hat{y}_{i}\)</span>.</p>
<p>Leverage values greater than <span class="math inline">\(2p/n\)</span> are considered large when <span class="math inline">\(n\)</span> is reasonably large.</p>
</section>
<section id="using-leverage-to-identify-hidden-extrapolation" class="level3" data-number="20.5.2">
<h3 data-number="20.5.2" class="anchored" data-anchor-id="using-leverage-to-identify-hidden-extrapolation"><span class="header-section-number">20.5.2</span> Using Leverage to Identify Hidden Extrapolation</h3>
<p>In simple regression, we stated that we did not want to <em>extrapolate</em> outside the range of the <span class="math inline">\(x\)</span> variable.</p>
<p>In multiple regression, we still do not want to extrapolate but now we cannot just think in terms of the range of each individual predictor variable. We must now think in terms of extrapolating for values combinations of the <span class="math inline">\(x\)</span> variables that we may not have seen information for in our data.</p>
<p>For example in the bodyfat data, tri had a range of about 14 to 32. The variable thigh had a range of values from about 42 to about 58.5. However, we did not have any observations with a tri of, say, 16 and a thigh of, say, 55. Those with small tri values also tended to have small thigh values. So this would be <em>hidden</em> extrapolation.</p>
<p>We can use the hat matrix to identify hidden extrapolation. This is done by using the vector of <span class="math inline">\(x\)</span> values you want to predict at, <span class="math inline">\({\bf X}_{new}\)</span>, and then including it in the hat matrix as <span id="eq-w5_13"><span class="math display">\[
\begin{align}
h_{new,new} &amp; ={\bf X}_{new}^{\prime}\left({\bf X}^{\prime}{\bf X}\right)^{-1}{\bf X}_{new}
\end{align}
\tag{20.10}\]</span></span></p>
<p>If the value of <span class="math inline">\(h_{new,new}\)</span> is much larger than the leverage values in the data set, then it indicates extrapolation.</p>
</section>
</section>
<section id="influential-cases" class="level2" data-number="20.6">
<h2 data-number="20.6" class="anchored" data-anchor-id="influential-cases"><span class="header-section-number">20.6</span> Influential Cases</h2>
<p>Once we have identified observations that are outlying with respect to <span class="math inline">\(y\)</span> or with respect to predictor variables, or both, we now want to know just how much it affects the fitted regression model.</p>
<p>If an observation causes major changes in the fitted model when excluded, then we say the observation is <em>influential</em>.</p>
<p>Not all outliers are influential. We will determine which are influential by seeing what happens to the fitted values when that observation is deleted as we did with the deleted residuals above.</p>
<section id="influence-on-a-single-fitted-value" class="level3" data-number="20.6.1">
<h3 data-number="20.6.1" class="anchored" data-anchor-id="influence-on-a-single-fitted-value"><span class="header-section-number">20.6.1</span> Influence on a Single Fitted Value</h3>
<p>We can see how much influence an observation has on a <em>single</em> fitted value <span class="math inline">\(\hat{y}_{i}\)</span> by examining <span id="eq-w5_14"><span class="math display">\[
\begin{align}
DFFITS_{i} &amp; =\frac{\hat{y}_{i}-\hat{y}_{i\left(i\right)}}{\sqrt{MSE_{(i)}h_{ii}}}
\end{align}
\tag{20.11}\]</span></span></p>
<p>As before, a new regression fit is not needed to obtain <span class="math inline">\(DFFITS_{i}\)</span>. It can be shown that <a href="#eq-w5_14">Equation&nbsp;<span>20.11</span></a> can be expressed as <span id="eq-w5_15"><span class="math display">\[
\begin{align}
DFFITS_{i} &amp; =t_{i}\left(\frac{h_{ii}}{1-h_{ii}}\right)^{1/2}
\end{align}
\tag{20.12}\]</span></span> which does not require a new regression fit excluding the <span class="math inline">\(i\)</span>th observation.</p>
<p>A general guideline is that a value of DFFITS greater than 1 for small to medium datasets and greater than <span class="math inline">\(2\sqrt{p/n}\)</span> for large datasets indicates an influential observation.</p>
</section>
<section id="influence-on-all-fitted-values" class="level3" data-number="20.6.2">
<h3 data-number="20.6.2" class="anchored" data-anchor-id="influence-on-all-fitted-values"><span class="header-section-number">20.6.2</span> Influence on All Fitted Values</h3>
<p>We can consider the influence of the <span class="math inline">\(i\)</span>th observation on all the fitted values <span class="math inline">\(\hat{y}_{i}\)</span> with a measure known as <em>Cook’s distance</em>.</p>
<p>It is defined as <span id="eq-w5_16"><span class="math display">\[
\begin{align}
D_{i} &amp; =\frac{\sum_{j=1}^{n}\left(\hat{y}_{j}-\hat{y}_{j\left(i\right)}\right)^{2}}{pMSE}\\
&amp; =\frac{e_{i}^{2}}{pMSE}\left(\frac{h_{ii}}{\left(1-h_{ii}\right)^{2}}\right)
\end{align}
\tag{20.13}\]</span></span></p>
<p>Note the last expression in <a href="#eq-w5_16">Equation&nbsp;<span>20.13</span></a> does not require a new fitted regression model for each <span class="math inline">\(i\)</span>.</p>
<p>From <a href="#eq-w5_16">Equation&nbsp;<span>20.13</span></a>, we see that <span class="math inline">\(D_{i}\)</span> depends on <span class="math inline">\(e_{i}\)</span> and <span class="math inline">\(h_{ii}\)</span>. If either one is large, then <span class="math inline">\(D_{i}\)</span> will be large.</p>
<p>So an influential observation can have a</p>
<ol type="1">
<li>large residual <span class="math inline">\(e_{i}\)</span> and a moderate leverage <span class="math inline">\(h_{ii}\)</span>,</li>
<li>a large leverage <span class="math inline">\(h_{ii}\)</span> and a moderate residual <span class="math inline">\(e_{i}\)</span>,</li>
<li>or both a large residual and large leverage.</li>
</ol>
</section>
<section id="influence-on-the-coefficients" class="level3" data-number="20.6.3">
<h3 data-number="20.6.3" class="anchored" data-anchor-id="influence-on-the-coefficients"><span class="header-section-number">20.6.3</span> Influence on the Coefficients</h3>
<p>We can also see the influence of an observation on the individual coefficients <span class="math inline">\(\hat{\beta}_{k}\)</span>, <span class="math inline">\(k=0,1,\ldots,p-1\)</span>. Again, we do this by seeing how much <span class="math inline">\(\hat{\beta}_{k}\)</span> changes when that observation is removed.</p>
<p>A measure of this change is <span class="math display">\[
\begin{align*}
DFBETAS_{k\left(i\right)} &amp; =\frac{\hat{\beta}_{k}-\hat{\beta}_{k\left(i\right)}}{\sqrt{MSE_{(i)}c_{kk}}}
\end{align*}
\]</span> where <span class="math inline">\(c_{kk}\)</span> is the <span class="math inline">\(k\)</span>th diagonal element of <span class="math inline">\(\left({\bf X}^{\prime}{\bf X}\right)^{-1}\)</span>.</p>
<p>The sign of <span class="math inline">\(DFBETAS\)</span> indicates whether <span class="math inline">\(\hat{\beta}_{k}\)</span> increases or decreases when the <span class="math inline">\(i\)</span>th observation is removed from the data. A large magnitude of <span class="math inline">\(DFBETAS\)</span> indicates the <span class="math inline">\(i\)</span>th observation is influential on the <span class="math inline">\(k\)</span>th coefficient.</p>
<p>A rule of thumb is a <span class="math inline">\(DFBETAS\)</span> value greater than 1 in absolute value for small to medium datasets and greater than <span class="math inline">\(2/\sqrt{n}\)</span> for large datasets indicates an influential observation.</p>
<div id="exm-20_1" class="theorem example">
<p><span class="theorem-title"><strong>Example 20.1 (Bodyfat data) </strong></span>Let’s examine the <code>bodyfat</code> data and determine if there is any observations that we should be concerned about.</p>
<p>We have already seen that there is an issue of multicollinearity in this data. The lasso fit in <a href="19_Ridge.html#exm-19_4">Example&nbsp;<span>19.4</span></a> showed that <code>tri</code> and <code>midarm</code> would have an important impact on <code>bfat</code>.</p>
<p>We can plot the studenitzed residuals versus the leverage values using the <code>olsrr</code> library.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(olsrr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">=</span> <span class="fu">read_table</span>(<span class="st">"BodyFat.txt"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>dat_recipe <span class="ot">=</span> <span class="fu">recipe</span>(bfat<span class="sc">~</span>tri<span class="sc">+</span>midarm, <span class="at">data =</span> dat)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">linear_reg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"lm"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>wf <span class="ot">=</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span> </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(dat_recipe) <span class="sc">|&gt;</span> </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(model)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> wf <span class="sc">|&gt;</span> <span class="fu">fit</span>(<span class="at">data =</span> dat)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>fit <span class="sc">|&gt;</span> <span class="fu">extract_fit_engine</span>() <span class="sc">|&gt;</span> <span class="fu">ols_plot_resid_lev</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="20_Outliers_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>We see from this plot that there are no outliers with respect to <span class="math inline">\(y\)</span> but there are two values that are potential outliers with respect to the predictor variables.</p>
<p>To determine if either of these points are also influential, we can use the</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>fit <span class="sc">|&gt;</span> <span class="fu">extract_fit_engine</span>() <span class="sc">|&gt;</span> <span class="fu">ols_plot_cooksd_chart</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="20_Outliers_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>We see that observation 3 (which was also high leverage) is influential to the fit. We can see which of the coefficients it has the largest influence on with DFBETAs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>fit <span class="sc">|&gt;</span> <span class="fu">extract_fit_engine</span>() <span class="sc">|&gt;</span> <span class="fu">ols_plot_dfbetas</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="20_Outliers_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>Since observation 3 has a large value of DFBETA for <code>midarm</code>, then we say that it is influential for this variable. Since the DFBETA is negative, then when we don’t have observation 3, then the estimated coefficient become larger than when we do have observation 3. To further investigate this observation, let’s do a scatterplot of <code>bfat</code> and <code>midarm</code> and highlight observation 3.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>midarm, <span class="at">y =</span> bfat))<span class="sc">+</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span> dat[<span class="dv">3</span>,], <span class="fu">aes</span>(<span class="at">x=</span>midarm, <span class="at">y =</span> bfat), <span class="at">color=</span><span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="20_Outliers_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>We see that this observation has an “average” <code>bfat</code> value but the <code>midarm</code> value is larger than any other observation. Further investigation would be needed to determine if this is an observation that should be deleted. For example, suppose this is a subject who also lifted weights. Is this the type of subject we want to include in this population of interest? If not, then the observation can be removed.</p>
</div>
<div id="exm-20_2" class="theorem example">
<p><span class="theorem-title"><strong>Example 20.2 (Hidden Extrapolation) </strong></span>Suppose we want to predict <code>bfat</code> for a woman in this population with <code>tri = 19.5</code> and <code>midarm = 29</code>.</p>
<p>Was our model fit with combinations of these two predictors close to the values we want to predict? If so, then the the hat value for this new observation, determined by <a href="#eq-w5_13">Equation&nbsp;<span>20.10</span></a> should be close to the hat values of the observations that were used to fit the model. If the hat value for the new observation is much larger than the other observation hat values, then this new value is <em>extrapolation</em>.</p>
<p>The <code>applicable</code> library allows us to compare the hat value of a new observation to that of the observations used to fit the data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(applicable)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>xnew <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">tri=</span><span class="fl">19.5</span>, <span class="at">midarm=</span><span class="dv">29</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>hat <span class="ot">=</span> <span class="fu">apd_hat_values</span>(dat_recipe, dat)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">score</span>(hat, xnew)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  hat_values hat_values_pctls
       &lt;dbl&gt;            &lt;dbl&gt;
1      0.175             88.7</code></pre>
</div>
</div>
<p>The hat value for this observation is in the 88.6th percentile of the hat values of the observations used to fit the model. Thus, this is not hidden extrapolation.</p>
<p>Let’s now try an observation with <code>tri=14</code> and <code>midarm=30</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>xnew <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">tri=</span><span class="dv">14</span>, <span class="at">midarm=</span><span class="dv">30</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>hat <span class="ot">=</span> <span class="fu">apd_hat_values</span>(dat_recipe, dat)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">score</span>(hat, xnew)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  hat_values hat_values_pctls
       &lt;dbl&gt;            &lt;dbl&gt;
1      0.504                1</code></pre>
</div>
</div>
<p>This new observation has a hat value higher than any hat value of the observations used to fit the model. This indicates that this combination of the predictor variable values was not used to fit the model. Thus, this is hidden extrapolation.</p>
</div>
<div id="exm-20_3" class="theorem example">
<p><span class="theorem-title"><strong>Example 20.3 (Surgical Unit data) </strong></span>Let’s examine the surgical unit data first seen in <a href="18_Stepwise.html#exm-18_1">Example&nbsp;<span>18.1</span></a>. Recall that the predictors <code>bcs</code>, <code>pindex</code>, <code>enzyme_test</code>, and <code>alc_heavy</code> were selected for a model determined by best subsets regression. We will now check for outliers and influential observations for this model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">=</span> surgical <span class="sc">|&gt;</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">ln_y =</span> <span class="fu">log</span>(y)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>dat_recipe <span class="ot">=</span> <span class="fu">recipe</span>(ln_y<span class="sc">~</span>bcs<span class="sc">+</span>pindex<span class="sc">+</span>enzyme_test<span class="sc">+</span>alc_heavy,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> dat)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">linear_reg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"lm"</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>wf <span class="ot">=</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span> </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(dat_recipe) <span class="sc">|&gt;</span> </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(model)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> wf <span class="sc">|&gt;</span> <span class="fu">fit</span>(<span class="at">data =</span> dat)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>fit <span class="sc">|&gt;</span> <span class="fu">extract_fit_engine</span>() <span class="sc">|&gt;</span> <span class="fu">ols_plot_resid_lev</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="20_Outliers_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>There is one clear outlier with respect to the response variable (observation 17). Examining the leverage values, we see there are five observations beyond the guideline. In a situation line this, we look for leverage values that are clearly separated from the others. There are two such values (observations 28 and 38). We will now examine these three in terms of influence.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>fit <span class="sc">|&gt;</span> <span class="fu">extract_fit_engine</span>() <span class="sc">|&gt;</span> <span class="fu">ols_plot_cooksd_chart</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="20_Outliers_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>Observations 17 and 38 are influential while observation 28 is not. So these two observations should be investigated further to determine if they should be removed. Let’s look at DFBETAs to get a better idea which coefficients are influenced by these observations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>fit <span class="sc">|&gt;</span> <span class="fu">extract_fit_engine</span>() <span class="sc">|&gt;</span> <span class="fu">ols_plot_dfbetas</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="20_Outliers_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="576"></p>
</div>
<div class="cell-output-display">
<p><img src="20_Outliers_files/figure-html/unnamed-chunk-9-2.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>Observation 17 is influential on the coefficients of <code>pindex</code> and <code>enzyme_test</code>. Observation 38 is influential on the coefficient of <code>pindex</code> and slightly influential for <code>enzyme_test</code>.</p>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./19_Ridge.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Ridge Regression and the LASSO</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./21_Residual.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Residual Analysis and Remedial Measures</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">STA 3386</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Fall 2024</div>
  </div>
</footer>



</body></html>